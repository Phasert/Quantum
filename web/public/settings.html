<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="user.css">
<link href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Arima:wght@100&family=Baskervville&family=Bodoni+Moda:ital,opsz@1,6..96&family=Castoro&family=Cinzel&family=Diphylleia&family=Forum&family=Gilda+Display&family=Krub:ital,wght@1,200&family=Manrope:wght@200&family=Playfair:ital,opsz,wght@1,5..1200,300&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Arima:wght@100&family=Baskervville&family=Bodoni+Moda:ital,opsz@1,6..96&family=Castoro&family=Cinzel&family=Diphylleia&family=Forum&family=Gilda+Display&family=IM+Fell+French+Canon&family=Krub:ital,wght@1,200&family=Manrope:wght@200&family=Playfair:ital,opsz,wght@1,5..1200,300&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />



<title>User Dashboard</title>
</head>
<body>

<div class="sidebar">
    <!-- Logo -->
    <div class="logo">
        <h1>REL Trading</h1>
    </div>

    <!-- Navigation Menu -->
    <ul class="nav-menu">
        <li class="nav-item"><a href="userDashboard.html"><i class="fas fa-grip-vertical" style="color: #ffffff;"></i> Dashboard</a></li>
        <li class="nav-item"><a href="order.html"><i class="fas fa-exchange-alt" style="color: #ffffff;"></i> Order History</a></li>
        <li class="nav-item"><a href="invoice.html"><i class="fas fa-file-invoice" style="color: #ffffff;"></i> Invoice</a></li>
        <li class="nav-item"><a href="index.html"><i class="fas fa-home" style="color: #ffffff;"></i> Home</a></li>
        <li class="nav-item"><a href="settings.html" class="active"><i class="fas fa-cog" style="color: #ffffff;"></i> Settings</a></li>
        <li class="nav-item"><a href="index.html"><i class="fas fa-sign-out-alt" style="color: #ffffff;"></i> Log Out</a></li>
    </ul>
    
</div>

<div class="main-content">
    <div class="dashboard-widget">
        <div class ="mail">
            <h3 id="mail">Your current Email is: <b>email</b></h3>
        </div>
        <h3>Email <button onclick="toggleEdit('email')">edit</button></h3>
        <div id="email-edit" style="display:none;">
            <input type="email" id="emailInput" placeholder="Enter new email">
            <button onclick="saveChanges('email')">Save</button>
        </div>
    </div>
    <div class="dashboard-widget">
        <div class ="phone">
            <h3 id="num">Your current Contact Number is: <b>phone</b></h3>
        </div>
        <h3>Contact No. <button onclick="toggleEdit('phone')">edit</button></h3>
        <div id="phone-edit" style="display:none;">
            <input type="tel" id="phoneInput" placeholder="Enter new contact number">
            <button onclick="saveChanges('phone')">Save</button>
        </div>
    </div>
    <div class="dashboard-widget">
        <h3>Password <button onclick="toggleEdit('pword')">edit</button></h3>
        <div id="pword-edit" style="display:none;">
            <input type="password" id="pwordInput" placeholder="Enter new password">
            <button onclick="saveChanges('pword')">Save</button>
        </div>
    </div>
    
</div>


<script>
    // This function is called when the document is ready
    document.addEventListener('DOMContentLoaded', function() {
        fetchUserData();
    });

    function fetchUserData() {
        fetch('/get-user-data')
            .then(response => {
                if (!response.ok) throw new Error('Failed to fetch user data');
                return response.json();
            })
            .then(data => {
                // Update the email and phone fields in the HTML
                if(data.email) document.getElementById('mail').innerHTML = `Your current Email is: <b>${data.email}</b>`;
                if(data.phone) document.getElementById('num').innerHTML = `Your current Contact Number is: <b>${data.phone}</b>`;
            })
            .catch(error => console.error('Error fetching user data:', error));
    }

    function toggleEdit(field) {
        var editDiv = document.getElementById(field + '-edit');
        editDiv.style.display = editDiv.style.display === "none" ? "block" : "none";
    }
    
    function saveChanges(field) {
        const inputElement = document.getElementById(`${field}Input`);
        const inputValue = inputElement.value;

        fetch('/update-customer-info', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ [field]: inputValue })
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            } else {
                throw new Error(`Error: ${response.statusText}`);
            }
        })
        .then(data => {
            alert('Information updated successfully');
            fetchUserData(); // Refresh user data to reflect changes
        })
        .catch(error => {
            alert('An error occurred. Please try again.');
            console.error('Fetch error:', error);
        });
    }
</script>

      <script src="app.js"></script>
</body>
</html>
